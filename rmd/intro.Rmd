# Introduction

Lung cancer is one of the most common types of cancer for both men and women. The analysis of survival time of patients with lung cancer is crucial for controlling the disease development, determining optimal treatment methods, and understanding what influences the disease progression. To accomplish these purposes, accurate survival analysis methods are needed.

Survival analysis is the combination of different statistical methods for analysing time-to-event data. Exploring survival models can be challenging, since different models from non-parametric to parametric can be used, and various distributions like exponential, Weibull, and log-normal are all applicable for each concrete case. The most common model is the Cox hazard model, however, it is too simple for this case, and proposes a constant effect of predictor variables on survival duration throughout time which we know to be untrue.

This study employs a Bayesian Weibull model of survival time data of patients with advanced lung cancer. The Weibull approach is more flexible than Cox, and the hazard rate is not assumed to be constant through time. For simulation Bayesian inference with MCMC is used, providing us with satisfying approximation of uncertainty and ability to use priors as domain knowledge. The model is implemented and tested with the help of R and Stan package.

We will investigate the effecicacy of three models: a pooled model across insitutions, trained on only observed data, a pooled model using censored data, and a hierarchical model not using censored data. The respective models will eventually be compared with regards to their predictive power.

The code with model implementation is provided in @git.

## Data description

### General description

The data used in the study shows survival of patients with advanced lung cancer from the North Central Cancer Treatment Group. It is provided in the `survival` R package from @survival-package. We aim to predict the survival time of patients with lung cancer.

Our dataset contains 9 features and 149 observations, which we divide into 7 institution groups, and which we assume to be independent and identically distributed. The target variable is the survival time in days. The covariates are both categorical and numerical values.

Special attention has to be paid for "censored status" feature. It indicates if the patient had some terminal event (in which case it is equal to $1$) or not (equal to $0$). If patient is censored, true survival time for him is not known. Right censoring approach is used, meaning incompleteness of survival time at the right side of the follow-up period.

Our variables, and their descriptions adapted from @survival-package, are as follows:

inst:	Institution code
time:	Survival time in days
status:	censoring status 1=censored, 2=dead
age:	Age in years
sex:	Male=1 Female=2
ph.ecog:	ECOG performance score (0-4). 0-good condition, 4-the worst condition.
ph.karno:	Karnofsky performance score (bad=0-good=100). Provided by physician.
pat.karno:	KKarnofsky performance score. Provided by patient.
meal.cal:	Calories consumed at meals
wt.loss:	Weight loss in last six months (pounds)

### Exploratory data analysis

It is better to provide some descriptive statistics to familiarize with data.

```{r,warning=FALSE,message=FALSE,results=FALSE}
library(dplyr)
library(ggplot2)
data("cancer", package = "survival")
```

There were 44 observations with missed values, which have been removed from dataset.
Now it consists of 105 rows.

```{r}
data = cancer %>% 
  filter(inst %in% c(1, 12, 13, 3, 11, 22, 16)) %>%
  na.omit()
```

Institutions are considered as variables, useful for hierarchical model. Note that to make this analysis more manageable, we are only considering data from the top 7 institutions in terms of number of datapoints for all models.

```{r}
table(data$inst)
```

Moving to categorical variables (fig.1), the number of men prevails over women. The majority of patients are ambulatory with symptoms.

```{r,fig.width=8,fig.height=4,fig.cap="Categorical variables"}
par(mfrow=c(1,2))
barplot(table(data$sex), main="Sex statistics", names.arg=c("male", "female"),
        col=c("steelblue","cornflowerblue"))
barplot(table(data$ph.ecog), main="ECOG score statistics",
        legend = c("asymptom.", "ambulatory", "in bed <50% of t", "in bed >50% of t"),
        args.legend = list(x = "topright",inset = c(- 0.15, 0)),
        col=c("steelblue","cornflowerblue","blue","darkblue"))
```

The distribution for continuous variables is shown in fig. 2. The features do not follow normal distribution.

```{r,fig.width=6,fig.height=6,fig.cap="Continuous variables"}
par(mfrow=c(3,2))
hist(data$age, freq=FALSE, col="cornflowerblue", main="Histogram of age",xlab="")
hist(data$ph.karno, freq=FALSE, col="cornflowerblue", main="Histogram of ph.karno",xlab="")
hist(data$pat.karno, freq=FALSE, col="cornflowerblue", main="Histogram of pat.karno",xlab="")
hist(data$meal.cal, freq=FALSE, col="cornflowerblue", main="Histogram of meal.cal",xlab="")
hist(data$wt.loss, freq=FALSE, col="cornflowerblue", main="Histogram of wt.loss",xlab="")
```

It is also useful to identify if there is linear correlation between variables. The correlation is not that high, the only one is between ph.karno and pat.karno (0.525), but it is reasonable, as since patient and doctor may measure the same quantity.

```{r}
cor(data[c(4,7,8,9,10)], method=c("pearson"))
```

## Related studies

The original data was presented in the work @original in 1994, it just provided descriptive information from a lung patient-completed questionnaire, which was aggregated into dataset.  In @parametric-survival the comparison of semi-parametric and non-parametric models for survival analysis was presented, but a different dataset was used, and there was no deep description of Weibull model implementation, i.e. more attention was payed to Cox regression. @exponential-model provided the description of exponential models, applied to lung cancer data analysis with Stan code. The Weibull distribution was just mentioned their as a possibility, but no formulas and conclusions were derived for Weibull model. That is why in our work two Weibull Survival models are built: a hierarchical and a pooled which will be described in the following section. The main approaches and theory of building survival models were used from the studies above, but the stan implementation, data preprocess, and choice of priors was made by the authors. 
